import{h as t,r as e,c as i,H as s,g as h}from"./p-da66e60c.js";import{T as n}from"./p-cfae6aaa.js";const r=({draggingState:e,size:i})=>{if(!e)return null;const{width:s,translation:h,dragContent:r,validTarget:o,targetId:a}=e,l={width:s,transform:`translate(calc(${h.x}px - 10%), calc(${h.y}px - 50%))`,msTransform:`translateX(${h.x}px) translateX(-10%) translateY(${h.y}px) translateY(-50%)`},d=`drag-content${a&&!o?" drop-block":" drop-allow"} ${n.get(i||"standard")}`;return t("div",{style:Object.assign({},l),ref:t=>t&&t.appendChild(r),class:d})};const o=class{constructor(t){e(this,t),this.itemDrop=i(this,"itemDrop",7),this.itemActionClick=i(this,"itemActionClick",7),this.items={},this.syncItems=[],this.onMouseMove=t=>this.handleItemDragOver(t),this.onMouseUp=()=>this.handleItemDrop(),this.onKeyDown=t=>this.handleArrowKeys(t),this.INITIAL_DRAG_POSITION={x:0,y:0},this.checkboxSelection=void 0,this.checkedItems=[],this.disableTabbing=void 0,this.expandedItems=[],this.multiCheckboxSelection=void 0,this.multiSelection=void 0,this.selectedItems=[],this.size="standard",this.borderless=void 0,this.itemDragState=void 0,this.isDraggingWithKeyboard=void 0}clearItemDropState(){if(!this.itemDragState)return null;const t=this.itemDragState,{targetId:e}=t,i=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(s=Object.getOwnPropertySymbols(t);h<s.length;h++)e.indexOf(s[h])<0&&Object.prototype.propertyIsEnumerable.call(t,s[h])&&(i[s[h]]=t[s[h]])}return i}(t,["targetId"]);return e&&(this.items[e].content.classList.remove("drop-allow"),this.items[e].content.classList.remove("drop-block")),Object.assign(Object.assign({},i),{targetId:null,validTarget:null})}handleDocumentClick(t){this.element.contains(t.target)||t.defaultPrevented||(this.focusItem=null)}handleItemDragState(t,e){e&&t&&e.itemId===t.itemId||(t?(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)):(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)))}handleDraggingWithKeyboard(t){t?document.addEventListener("keydown",this.onKeyDown):document.removeEventListener("keydown",this.onKeyDown)}handleItemDragStart(t,e,i){const{clientX:s,clientY:h,currentTarget:n}=i,r=null==n?void 0:n.parentElement,o={x:s,y:h};this.clearItemDropState(),this.itemDragState={dragContent:e,origin:o,translation:o,itemId:t,width:`${null==r?void 0:r.offsetWidth}px`,height:`${null==r?void 0:r.offsetHeight}px`}}handleItemDragStartKeyboard(t,e,i){if("Escape"===i.code&&this.itemDragState&&(e.style.transform=`translate(${this.INITIAL_DRAG_POSITION.x}px, ${this.INITIAL_DRAG_POSITION.y}px)`,this.clearItemDropState(),this.itemDragState=null),"Enter"===i.code)if(this.currentItem=null,this.isDraggingWithKeyboard)this.handleItemDrop(),this.isDraggingWithKeyboard=!1;else{const{currentTarget:s}=i,h=null==s?void 0:s.parentElement,n={x:h.getBoundingClientRect().x+40,y:h.getBoundingClientRect().y+20};this.clearItemDropState(),this.itemDragState={dragContent:e,origin:n,translation:n,itemId:t,width:`${null==h?void 0:h.offsetWidth}px`,height:`${null==h?void 0:h.offsetHeight}px`},this.isDraggingWithKeyboard=!0}}handleKeys(t,e=!1){this.currentItem=1===t?this.items[this.getNextNavigableItem(this.currentItem.nodeId,e)]:this.items[this.getPrevNavigableItem(this.currentItem.nodeId,e)]}handleArrowKeys(t){if(!this.itemDragState)return;const e="ArrowUp"===t.key?-1:"ArrowDown"===t.key?1:0;if(0===e)return;this.currentItem||(this.currentItem=this.items[this.itemDragState.itemId]),this.handleKeys(e),1==e?(this.currentItem==this.items[this.getNextNavigableItem(this.itemDragState.itemId)]&&this.handleKeys(e),this.currentItem==this.items[this.itemDragState.itemId]&&this.handleKeys(e,!0)):this.currentItem==this.items[this.getNextNavigableItem(this.itemDragState.itemId)]&&this.handleKeys(e,!0);let i=Object.assign({},this.clearItemDropState());if(this.currentItem.nodeId&&this.currentItem.nodeId!==i.itemId){const t=this.getParentIds(this.currentItem.nodeId);i=Object.assign(Object.assign({},i),{targetId:this.currentItem.nodeId}),!this.currentItem.element.droppableItem||this.isItemDisabled(this.currentItem.nodeId)||t&&t.includes(i.itemId)?(i.validTarget=!1,this.currentItem.content.classList.add("drop-block")):(i.validTarget=!0,this.currentItem.content.classList.add("drop-allow"))}this.itemDragState=Object.assign({},i)}handleItemDragOver(t){if(!this.itemDragState)return;const{clientX:e,clientY:i}=t,s={x:e,y:i},{nodeId:h,element:n,content:r}=this.getItemWithinBounds(e,i)||{};let o=Object.assign(Object.assign({},this.clearItemDropState()),{translation:s});if(h&&h!==o.itemId){const t=this.getParentIds(h);o=Object.assign(Object.assign({},o),{targetId:h}),!n.droppableItem||this.isItemDisabled(h)||t&&t.includes(o.itemId)?(o.validTarget=!1,r.classList.add("drop-block")):(o.validTarget=!0,r.classList.add("drop-allow"))}this.itemDragState=Object.assign({},o)}handleItemDrop(){var t;if(!this.itemDragState)return;const{itemId:e,targetId:i,validTarget:s}=this.itemDragState;if(e&&s&&e!==i){const{parentId:e,element:s}=this.items[i];s&&(((null===(t=this.items[e])||void 0===t?void 0:t.element)||this.element).insertBefore(this.items[this.itemDragState.itemId].element,s),this.itemDrop.emit(this.items))}this.clearItemDropState(),this.itemDragState=null}handleItemsProps(t,e){this.syncItems.push(...e||[],...t||[])}handleOptionsProps(){const t=this.getTreeViewItemOptions();Object.values(this.items).forEach((({element:e})=>{e.initTreeViewItem(t)}))}handleTreeSlotChange(){Array.from(this.element.children).map((t=>t.nodeId)).filter((t=>t)).forEach(((t,e)=>{this.updateItem({nodeId:t,index:e,parentId:null})}))}getItemWithinBounds(t,e){return Object.values(this.items).find((({content:i})=>{const s=null==i?void 0:i.getBoundingClientRect();return!!s&&(e>=s.top&&e<=s.bottom&&t>=s.left&&t<=s.right)}))}getParentIds(t){if(!t)return[];const{parentId:e}=this.items[t];return e?[e,...this.getParentIds(e)]:[]}addItem(t){const e=t,i=t.parentNode;if(e.nodeId){const{children:t,nodeId:s}=i,h=Array.from(t).filter((t=>t.nodeId)).indexOf(e),n=this.getLevel(s)+1;this.items[e.nodeId]=Object.assign(Object.assign({},this.items[e.nodeId]),{nodeId:e.nodeId,index:h,element:e,disabled:e.disabled,parentId:s,level:n}),e.initTreeViewItem(this.getTreeViewItemOptions())}}componentDidUpdate(){var t;null===(t=this.syncItems)||void 0===t||t.forEach((t=>this.syncTreeViewItem(t))),this.syncItems=[]}deleteItem(t){const e=this.items[t];let i=[];if(e){e.children.forEach((t=>{delete this.items[t],i.push(t)})),delete this.items[t],i.push(t);const s=t=>t.find((t=>i.includes(t)))?t.filter((t=>!i.includes(t))):t;this.checkedItems=s(this.checkedItems),this.selectedItems=s(this.selectedItems),this.expandedItems=s(this.expandedItems),i.includes(this.focusItem)&&(this.focusItem=null)}}getChildrenIds(t,e=!0){var i;const s=null===(i=this.items[t])||void 0===i?void 0:i.children;return s?Array.from(s).map((t=>this.items[t])).sort(((t,e)=>t.index-e.index)).reduce(((t,i)=>(t.push(i.nodeId,...e?this.getChildrenIds(i.nodeId,e):[]),t)),[]):[]}getLevel(t){var e;return(null===(e=this.items[t])||void 0===e?void 0:e.level)||0}getFirstItem(){const t=this.element.firstElementChild;return t?t.nodeId:null}getLastItem(){const t=this.element.lastElementChild;if(t){const e=t;let i=e.nodeId;return this.isItemExpanded(e.nodeId)&&(i=this.getChildrenIds(e.nodeId,!0).slice(-1)[0]),i}return null}getNavigableChildrenIds(t){let e=[];return e=t?this.getChildrenIds(t,!1):Object.values(this.items).filter((t=>!t.parentId)).sort(((t,e)=>t.index-e.index)).map((t=>t.nodeId)),e.filter((t=>!this.isItemDisabled(t)))}getNextNavigableItem(t,e=!1){if(this.isItemExpanded(t)){const e=this.getNavigableChildrenIds(t);if(e.length)return e[0]}let i=this.items[t];for(;null!=i;){const t=this.getNavigableChildrenIds(i.parentId),s=t.indexOf(i.nodeId),h=t[e?s+2:s+1];if(h)return h;i=this.items[i.parentId]}return t}getPrevNavigableItem(t,e=!1){const i=this.items[t],s=this.getNavigableChildrenIds(i.parentId),h=s.indexOf(t);if(0===h)return i.parentId||t;let n=e?h-2:h-1;n<0&&(n=0);let r=s[n];for(;this.isItemExpanded(r)&&this.getNavigableChildrenIds(r).length>0;)r=this.getNavigableChildrenIds(r).pop();return r}getTreeViewItemOptions(){return{multiSelection:this.multiSelection,checkboxSelection:this.checkboxSelection,multiCheckboxSelection:this.multiCheckboxSelection,size:this.size,borderless:this.borderless,disableTabbing:this.disableTabbing,getLevel:t=>this.getLevel(t),hasItemFocus:t=>this.isItemInFocus(t),hasItemSelected:t=>this.isItemSelected(t),hasItemDisabled:t=>this.isItemDisabled(t),hasItemExpanded:t=>this.isItemExpanded(t),hasItemChecked:t=>this.isItemChecked(t),hasItemIndeterminate:t=>this.isItemIndeterminate(t),showSelectionIndicator:t=>this.showSelectionIndicator(t),onItemSelection:(t,e)=>this.handleItemSelection(t,e),onCheckboxSelection:(t,e)=>this.handleCheckboxSelection(t,e),onItemExpandToggle:t=>this.handleItemExpand(t),onItemFocus:t=>this.handleItemFocus(t),onItemAdd:t=>this.addItem(t),onItemDelete:t=>this.deleteItem(t),onItemUpdate:(t,e)=>this.updateItem(t,e),onItemDrag:(t,e,i)=>this.handleItemDragStart(t,e,i),onItemDragClick:(t,e,i)=>this.handleItemDragStartKeyboard(t,e,i)}}handleCheckboxSelection(t,e=!1){if(this.items[t].disabled)return;let i=!this.isItemChecked(t),s=[...this.checkedItems],h=[...this.checkedItems,t];if(this.multiCheckboxSelection){if(e){const e=this.getChildrenIds(t,!1);i=e.filter((t=>s.includes(t))).length===e.length,i?s.push(t):s=s.filter((e=>e!==t))}else{const e=this.getChildrenIds(t,!0);i?s.push(t,...e):s=s.filter((e=>e!==t)).filter((t=>!e.includes(t))),h.push(...e)}const n=this.getParentIds(t);n.forEach((t=>{const e=this.getChildrenIds(t,!1);e.filter((t=>s.includes(t))).length===e.length?s.push(t):s=s.filter((e=>e!==t))})),h.push(...n)}else s=i?[t]:[];this.checkedItems=[...s],this.syncItems.push(...h,...s)}handleItemAdded(t){this.addItem(t.detail),t.preventDefault(),t.stopPropagation()}handleItemClick(t){const e=t.detail.actionId,i=t.target.getAttribute("node-id");this.itemActionClick.emit({actionId:e,nodeId:i})}handleItemExpand(t){const{children:e}=this.items[t];if(!e||!e.length)return;const i=!this.isItemExpanded(t);let s=[...this.expandedItems];i?s.push(t):s=s.filter((e=>e!==t)),this.expandedItems=[...s],this.syncItems.push(t)}handleItemFocus(t){const{element:e}=this.items[t];this.focusItem=t,e.focusItem()}handleItemSelection(t,e){if(this.items[t].disabled)return;const i=this.multiSelection&&e&&(e.shiftKey||e.ctrlKey||e.metaKey),s=!this.isItemSelected(t),h=[...this.selectedItems];let n=[...this.selectedItems];s?i?n.push(t):n=[t]:n=n.filter((e=>e!==t)),this.selectedItems=[...n],this.syncItems.push(...h,...n)}handleKeyDown(t){if(t.defaultPrevented||t.altKey)return;const e=t.code.toUpperCase();let i=!1;if(!this.isDraggingWithKeyboard)switch(e){case"SPACE":this.focusItem&&(this.handleItemExpand(this.focusItem),i=!0);break;case"ENTER":this.focusItem&&(this.handleItemSelection(this.focusItem,t),t.stopPropagation());break;case"ARROWDOWN":const e=this.focusItem?this.getNextNavigableItem(this.focusItem):this.getFirstItem();this.multiSelection&&t.shiftKey&&this.isItemSelected(this.focusItem)&&(this.isItemSelected(e)?this.handleItemSelection(this.focusItem,t):this.handleItemSelection(e,t)),this.handleItemFocus(e),i=!0;break;case"ARROWUP":const s=this.focusItem?this.getPrevNavigableItem(this.focusItem):this.getLastItem();this.multiSelection&&t.shiftKey&&this.isItemSelected(this.focusItem)&&(this.isItemSelected(s)?this.handleItemSelection(this.focusItem,t):this.handleItemSelection(s,t)),this.handleItemFocus(s),i=!0;break;case"ARROWRIGHT":if(this.focusItem)if(this.disableTabbing&&t.shiftKey){const{element:t}=this.items[this.focusItem];t.focusCheckbox()}else this.isItemExpanded(this.focusItem)||this.handleItemExpand(this.focusItem);break;case"ARROWLEFT":this.focusItem&&this.isItemExpanded(this.focusItem)&&this.handleItemExpand(this.focusItem);break;case"TAB":this.disableTabbing&&this.resetFocusItem()}i&&(t.preventDefault(),t.stopPropagation())}isItemChecked(t){return this.checkedItems.includes(t)}isItemExpanded(t){return this.expandedItems.includes(t)}isItemInFocus(t){return this.focusItem===t}isItemSelected(t){return this.selectedItems.includes(t)}isItemIndeterminate(t){const e=this.getChildrenIds(t);if(e&&this.multiCheckboxSelection){const t=e.filter((t=>this.isItemChecked(t)));return t.length>0&&t.length<e.length}return!1}isItemDisabled(t){const{disabled:e}=this.items[t],i=this.getParentIds(t);return e||Boolean(null==i?void 0:i.find((t=>this.items[t].disabled)))}resetFocusItem(){this.focusItem=null}showSelectionIndicator(t){return this.isItemSelected(t)||!this.isItemExpanded(t)&&Boolean(this.getChildrenIds(t,!0).find((t=>this.isItemSelected(t))))}syncTreeViewItem(t){var e,i;null===(i=null===(e=this.items[t])||void 0===e?void 0:e.element)||void 0===i||i.updateComponent()}updateItem(t,e){var i;let s;e&&t.nodeId!==e.nodeId?(s=Object.assign({},this.items[e.nodeId]),delete this.items[e.nodeId]):s=Object.assign({},this.items[t.nodeId]),s.nodeId?(this.items[t.nodeId]=Object.assign(Object.assign({},s),t),null===(i=t.children)||void 0===i||i.forEach((e=>{this.items[e]=Object.assign(Object.assign({},this.items[e]),{parentId:t.nodeId})}))):this.items[t.nodeId]=Object.assign({},t)}render(){return t(s,{key:"66babb70ff1b7fb4ee1c9d1bbff24fb2cd4b31dc"},t("ul",{key:"60012ff7564d2d73dfebfd94fc998827a0ea6187",role:"tree",tabindex:this.disableTabbing?0:null,onKeyDown:t=>this.handleKeyDown(t)},t("slot",{key:"ac0971a2f22edf9fb65d197c7a7313b16fcb6d23",onSlotchange:()=>this.handleTreeSlotChange()})),t(r,{key:"f68ae591618566c112a788215ea4027a3f471ec0",draggingState:this.itemDragState},t("div",{key:"39a3842b2993fff40a5b224eb7646938e7dfc44f",class:"drag-indicator",tabIndex:-1})))}get element(){return h(this)}static get watchers(){return{itemDragState:["handleItemDragState"],isDraggingWithKeyboard:["handleDraggingWithKeyboard"],expandedItems:["handleItemsProps"],selectedItems:["handleItemsProps"],checkedItems:["handleItemsProps"],checkboxSelection:["handleOptionsProps"],disableTabbing:["handleOptionsProps"],multiCheckboxSelection:["handleOptionsProps"],multiSelection:["handleOptionsProps"],size:["handleOptionsProps"],borderless:["handleOptionsProps"]}}};o.style='@import url("https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700");.drag-content{cursor:grabbing !important;left:0;opacity:0.9;position:fixed;top:0;z-index:99999}.drag-content .tree-item{align-items:center;background-color:var(--modus-tree-view-item-bg, #fff);border:0.0625rem solid var(--modus-tree-view-item-border-color, #e0e1e9);color:var(--modus-tree-view-item-color, #252a2e);display:flex;font-family:"Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-size:1rem;height:2.375rem;width:100%}.drag-content .tree-item .icon-slot{visibility:hidden}.drag-content .tree-item.large{height:2.875rem}.drag-content .tree-item.small{font-size:0.75rem;height:1.875rem}.drag-content.drop-allow .tree-item{border:2px dashed var(--modus-tree-view-item-drag-border-color, #217cbb) !important}.drag-content.drop-block .tree-item{border:2px dashed var(--modus-tree-view-item-drag-error-border-color, #da212c) !important}:host{display:block}ul{padding:0}';export{o as modus_tree_view}